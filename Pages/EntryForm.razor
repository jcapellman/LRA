@page "/form/{coursetype}"

@using LRA.Models
@inject LRA.Services.MailService mService

<h3>Registration for @courseType</h3>

@if (submitted)
{
    <p>Thank you, your course registration has been received. Lookout for a follow up in the next 24-48 business hours.</p>
} else {
    <EditForm Model="model" OnValidSubmit="HandleValidSubmit">
        <p>
            <label>
                Name<br/>
                <InputText @bind-Value="model.Name" />
            </label>

            <br/>

            <label>
                Email Address<br>
                <InputText @bind-Value="model.EmailAddress" />
            </label>
        </p>

	    <button type="submit" class="btn btn-primary">Submit</button>
    </EditForm>
}

@code {
    private RegistrationModel model = new();

    private bool submitted;

    [Parameter]
	public string courseType { get; set; }

	protected override void OnInitialized()
    {
        submitted = false;
        model.CourseType = courseType;
	}

    private async void HandleValidSubmit()
    {
        submitted = true;

        var result = await mService.SendEntryForm(model.Name, model.EmailAddress, model.CourseType);

        if (!result)
        {
            // TODO Handle Error
        }

        StateHasChanged();
    }
}